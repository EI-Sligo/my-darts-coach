<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DartsOS v8.2: Club Edition</title>
    <style>
        :root {
            --bg: #121212; --panel: #1e1e1e; --primary: #00e676; --secondary: #2979ff; --danger: #ff1744;
            --text-main: #ffffff; --text-dim: #b0bec5; --highlight: #ffd700;
        }
        body { background: var(--bg); color: var(--text-main); font-family: system-ui, -apple-system, sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; user-select: none; }
        .screen { display: none; flex-direction: column; height: 100%; width: 100%; }
        .screen.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        header { padding: 15px; background: var(--panel); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .icon-btn { background: #333; color: #aaa; border: 1px solid #444; border-radius: 8px; padding: 8px 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; transition: all 0.2s; }
        .icon-btn.active { background: var(--primary); color: black; border-color: var(--primary); }
        .icon-btn.listening { background: var(--danger); color: white; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .main-area { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 10px; overflow-y: auto; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; max-width: 600px; margin-bottom: 20px; }
        .menu-card { background: var(--panel); border: 1px solid #333; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; position: relative; overflow: hidden; }
        .menu-card:active { transform: scale(0.98); border-color: var(--primary); }
        .chart-container { width: 100%; max-width: 600px; height: 150px; background: #222; border-radius: 12px; margin-top: 10px; position: relative; border: 1px solid #333; }
        .hud-panel { width: 100%; max-width: 600px; background: var(--panel); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .hud-score-box { text-align: center; flex: 1; transition: opacity 0.3s; }
        .hud-score-box.inactive { opacity: 0.4; }
        .hud-score { font-size: 2.5rem; font-weight: bold; color: var(--primary); }
        .hud-label { font-size: 0.8rem; color: var(--text-dim); text-transform: uppercase; }
        .bot-score { color: var(--danger); }
        .leg-score { background: #333; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 1.2rem; margin: 0 10px; }
        .checkout-hint { background: #333; color: var(--highlight); padding: 5px 10px; border-radius: 4px; font-size: 0.9rem; font-weight: bold; margin-top: 5px; display: inline-block; min-height: 20px; border: 1px solid #444; }
        #board-container { width: 100%; max-width: 450px; aspect-ratio: 1/1; position: relative; margin: 10px 0; flex-shrink: 0; display: block; }
        svg { width: 100%; height: 100%; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5)); }
        #numpad-container { width: 100%; max-width: 450px; height: 400px; display: none; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 10px 0; }
        .pad-btn { background: #333; color: white; border: none; border-radius: 8px; font-size: 1.5rem; font-weight: bold; cursor: pointer; }
        .pad-btn:active { background: var(--primary); color: black; }
        .pad-enter { background: var(--primary); color: black; grid-column: span 3; }
        .controls { display: flex; gap: 10px; width: 100%; max-width: 450px; padding-bottom: 20px; margin-top: auto; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer; background: #333; color: white; }
        .btn-primary { background: var(--primary); color: black; }
        .btn-miss { background: #424242; color: #ff5252; border: 1px solid #ff5252; flex: 0.4; }
        .rank-badge { background: var(--highlight); color: black; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; position: absolute; top: 10px; right: 10px; }
        polyline { fill: none; stroke: var(--primary); stroke-width: 2; vector-effect: non-scaling-stroke; }
    </style>
</head>
<body>

<div id="screen-menu" class="screen active">
    <header>
        <h1>üéØ DartsOS <span style="font-size:0.6em; background:var(--primary); color:#000; padding:2px 6px; border-radius:4px;">v8.2</span></h1>
        <div style="display:flex; gap:10px;">
            <div id="settings-btn" class="icon-btn" onclick="Stats.exportData()">üíæ</div>
        </div>
    </header>
    <div class="main-area">
        <div style="width:100%; max-width:600px; display:flex; justify-content:space-between; align-items:end; margin-top:10px;">
            <span style="font-size:0.9rem; color:#aaa;">Your Form (Last 10 Matches)</span>
            <span id="current-avg-display" style="font-weight:bold; color:var(--primary)">Avg: --</span>
        </div>
        <div class="chart-container" id="chart-area"></div>
        <h2 style="margin-top: 20px;">Game Modes</h2>
        <div class="menu-grid">
            <div class="menu-card" onclick="app.loadMode('league')">
                <span class="rank-badge" id="league-rank">ROOKIE</span><span style="font-size:2rem">üèÜ</span><br><b>Bot League</b><br><span style="font-size:0.8rem; color:#888">Single Player</span>
            </div>
            <div class="menu-card" onclick="app.loadMode('pvp')">
                <span style="font-size:2rem">üë•</span><br><b>Vs Player</b><br><span style="font-size:0.8rem; color:#888">Pass & Play (PVP)</span>
            </div>
            <div class="menu-card" onclick="app.loadMode('jdc')">
                <span style="font-size:2rem">ü•ã</span><br><b>JDC Academy</b><br><span style="font-size:0.8rem; color:#888">Official Routine</span>
            </div>
            <div class="menu-card" onclick="app.loadMode('bobs27')">
                <span style="font-size:2rem">‚ò†Ô∏è</span><br><b>Bob's 27</b><br><span style="font-size:0.8rem; color:#888">Doubles Practice</span>
            </div>
            <div class="menu-card" onclick="app.loadMode('practice')">
                <span style="font-size:2rem">üî•</span><br><b>Heatmap</b><br><span style="font-size:0.8rem; color:#888">Analysis</span>
            </div>
        </div>
        <button class="btn" style="background:#222; margin-top:10px; font-size:0.8rem" onclick="Stats.clear()">Reset Career</button>
    </div>
</div>

<div id="screen-game" class="screen">
    <header>
        <h1 id="game-title">Game</h1>
        <div style="display:flex; gap:10px; align-items:center;">
            <div id="input-toggle" class="icon-btn" onclick="app.toggleInput()">üéØ</div>
            <div id="mic-toggle-game" class="icon-btn" onclick="Voice.toggle()">üéôÔ∏è</div>
            <button class="btn" style="width: auto; padding: 5px 15px; font-size: 0.8rem;" onclick="app.goHome()">Exit</button>
        </div>
    </header>
    <div class="main-area">
        <div class="hud-panel">
            <div class="hud-score-box" id="p1-box">
                <div class="hud-label" id="hud-lbl-1">YOU</div>
                <div class="hud-score" id="hud-val-1">501</div>
                <div class="checkout-hint" id="checkout-display"></div>
            </div>
            <div class="leg-score" id="match-score-display">0 - 0</div>
            <div class="hud-score-box" id="p2-box">
                <div class="hud-label" id="hud-lbl-2">BOT</div>
                <div class="hud-score bot-score" id="hud-val-2">501</div>
                <div class="hud-label" id="hud-sub-2"></div>
            </div>
        </div>
        <div id="board-container"></div>
        <div id="numpad-container">
            <button class="pad-btn" onclick="app.numpadAdd(1)">1</button><button class="pad-btn" onclick="app.numpadAdd(2)">2</button><button class="pad-btn" onclick="app.numpadAdd(3)">3</button>
            <button class="pad-btn" onclick="app.numpadAdd(4)">4</button><button class="pad-btn" onclick="app.numpadAdd(5)">5</button><button class="pad-btn" onclick="app.numpadAdd(6)">6</button>
            <button class="pad-btn" onclick="app.numpadAdd(7)">7</button><button class="pad-btn" onclick="app.numpadAdd(8)">8</button><button class="pad-btn" onclick="app.numpadAdd(9)">9</button>
            <button class="pad-btn" style="color:#ff5252" onclick="app.numpadClear()">CLR</button><button class="pad-btn" onclick="app.numpadAdd(0)">0</button>
            <button class="pad-enter" onclick="app.numpadSubmit()">ENTER SCORE</button>
        </div>
        <div id="status-msg" style="height:20px; color:#aaa; font-style:italic;">Target: Open</div>
        <div class="controls" id="touch-controls">
            <button class="btn" onclick="app.undo()">Undo</button>
            <button class="btn btn-miss" onclick="app.handleHit(0, 'MISS', null)">Miss</button>
            <button class="btn btn-primary" id="btn-next" onclick="app.handleAction()">Next Round</button>
        </div>
    </div>
</div>

<script>
// --- CONFIGURATION ---
const BOTS = [
    { name: "Pub Rookie", avg: 35, checkout: 0.1 },
    { name: "Local Champ", avg: 45, checkout: 0.2 },
    { name: "County Player", avg: 55, checkout: 0.4 },
    { name: "Semi-Pro", avg: 70, checkout: 0.6 },
    { name: "The Iceman", avg: 95, checkout: 0.9 }
];

// --- STRATEGIST ---
const Strategist = {
    getCheckout: function(e) {
        if(e > 170 || e < 2) return "";
        const t = {
            170:"T20 T20 Bull", 167:"T20 T19 Bull", 164:"T20 T18 Bull", 161:"T20 T17 Bull",
            160:"T20 T20 D20", 158:"T20 T20 D19", 156:"T20 T20 D18", 150:"T20 T18 D18",
            140:"T20 T16 D16", 136:"T20 T20 D8", 132:"T20 T20 D6", 130:"T20 T18 D8",
            126:"T19 T19 D6", 121:"T20 T11 D14", 120:"T20 20 D20", 116:"T20 16 D20",
            110:"T20 10 D20", 100:"T20 D20", 96:"T20 D18", 90:"T18 D18",
            82:"Bull D16", 80:"T20 D10", 76:"T20 D8", 72:"T16 D12", 70:"T18 D8",
            60:"20 D20", 50:"10 D20", 40:"D20", 36:"D18", 32:"D16", 20:"D10", 16:"D8"
        };
        return t[e] ? t[e] : (e <= 40 && e % 2 == 0 ? "D" + e/2 : "");
    }
};

// --- AUDIO ---
const Speaker = {
    speak: function(e, t) {
        if(!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        if (180 === t) {
            const o = new SpeechSynthesisUtterance("ONE HUNDRED AND EIGHTY!");
            o.pitch = .8, o.volume = 1, window.speechSynthesis.speak(o);
            return;
        }
        const o = new SpeechSynthesisUtterance(e);
        t >= 100 ? o.pitch = .9 : t >= 60 ? o.pitch = 1 : o.pitch = 1.1;
        window.speechSynthesis.speak(o);
    }
};

// --- VOICE ---
const Voice = {
    recognition: null,
    isListening: !1,
    init: function() {
        if (!("webkitSpeechRecognition" in window) && !("SpeechRecognition" in window)) return;
        const e = window.SpeechRecognition || window.webkitSpeechRecognition;
        this.recognition = new e, this.recognition.continuous = !0, this.recognition.interimResults = !1, this.recognition.lang = "en-US", this.recognition.onresult = e => this.processCommand(e.results[e.results.length - 1][0].transcript), this.recognition.onend = () => {
            this.isListening && this.recognition.start()
        }
    },
    toggle: function() {
        this.recognition || this.init(), this.recognition && (this.isListening ? (this.recognition.stop(), this.isListening = !1) : (this.recognition.start(), this.isListening = !0));
        const e = this.isListening ? "icon-btn listening" : "icon-btn";
        document.getElementById("mic-toggle-menu").className = e, document.getElementById("mic-toggle-game").className = e
    },
    processCommand: function(e) {
        const t = e.toLowerCase().trim();
        if (t.includes("next")) return void app.handleAction();
        if (t.includes("undo")) return void app.undo();
        if (t.includes("miss")) return void app.handleHit(0, "MISS");
        let o = "S";
        t.includes("double") && (o = "D"), (t.includes("triple") || t.includes("treble")) && (o = "T");
        let n = 0;
        if (t.includes("bullseye") || t.includes("50") ? n = 50 : t.includes("25") ? n = 25 : t.includes("bull") && (n = 50), 0 === n) {
            const e = t.match(/(\d+)/);
            if (e) n = parseInt(e[0]);
            else {
                const e = {one: 1, two: 2, three: 3, four: 4, five: 5, six: 6, seven: 7, eight: 8, nine: 9, ten: 10, twenty: 20};
                for (let o in e) t.includes(o) && (n = e[o])
            }
        }
        n > 0 && n <= 50 && (25 === n && "T" === o || (50 === n && (n = 25, o = "D"), app.handleHit(n, o)))
    }
};

// --- STATS ---
const Stats = {
    data: { matches: [], leagueRank: 0, drillLevel: 0, heatmap: [] },
    load: function() {
        const e = localStorage.getItem("darts_v8");
        e && (this.data = JSON.parse(e)), this.renderChart(), this.updateBadges()
    },
    save: function() { localStorage.setItem("darts_v8", JSON.stringify(this.data)) },
    addMatch: function(e, t) {
        this.data.matches.push({ avg: parseFloat(e), result: t, type: "x01" }), this.data.matches.length > 20 && this.data.matches.shift(), this.save()
    },
    addHeatmapPoint: function(e, t) {
        this.data.heatmap.push({ x: e, y: t }), this.data.heatmap.length > 2e3 && this.data.heatmap.shift(), this.save()
    },
    updateLeague: function(e) { e === this.data.leagueRank && (this.data.leagueRank++, this.save()) },
    exportData: function() {
        const e = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(this.data)), t = document.createElement("a");
        t.setAttribute("href", e), t.setAttribute("download", "dartsos_backup.json"), document.body.appendChild(t), t.click(), t.remove()
    },
    clear: function() { confirm("Wipe entire career history?") && (localStorage.removeItem("darts_v8"), location.reload()) },
    renderChart: function() {
        const e = document.getElementById("chart-area"), t = this.data.matches.filter(e => "x01" === e.type);
        if (t.length < 2) return e.innerHTML = "<div style='padding:60px; text-align:center; color:#555;'>Play Tournament to see graph</div>", void(document.getElementById("current-avg-display").innerText = "Avg: --");
        const o = t.map(e => e.avg), n = Math.max(...o) + 5, a = Math.max(0, Math.min(...o) - 5), r = 600, i = 150;
        let d = "";
        o.forEach((e, t) => { d += `${t/(o.length-1)*r},${i-(e-a)/(n-a)*i} ` });
        const c = o.slice(-3), s = (c.reduce((e, t) => e + t, 0) / c.length).toFixed(1);
        document.getElementById("current-avg-display").innerText = "Avg: " + s, e.innerHTML = `<svg width="100%" height="100%" viewBox="0 0 ${r} ${i}" preserveAspectRatio="none"><line x1="0" y1="${i/2}" x2="${r}" y2="${i/2}" stroke="#333" stroke-dasharray="4" /><polyline points="${d}" /></svg>`
    },
    updateBadges: function() {
        const e = ["ROOKIE", "AMATEUR", "SEMI-PRO", "PRO", "ELITE"];
        document.getElementById("league-rank").innerText = e[Math.min(4, this.data.leagueRank)]
    }
};

// --- RENDERER ---
const BoardRenderer = {
    render: function(e, t = !1) {
        const o = document.getElementById("board-container");
        o.innerHTML = "";
        const n = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        n.setAttribute("viewBox", "0 0 450 450"), n.id = "dartboard-svg";
        const a = [20, 1, 18, 4, 13, 6, 10, 15, 2, 17, 3, 19, 7, 16, 8, 11, 14, 9, 12, 5], r = 225;

        function i(t, o, i, d, c) {
            const s = 360 / 20;
            a.forEach((a, l) => {
                const u = (l * s - s / 2) * Math.PI / 180 - Math.PI / 2, h = (l * s + s / 2) * Math.PI / 180 - Math.PI / 2,
                    p = `M${r+t*Math.cos(u)},${r+t*Math.sin(u)} L${r+o*Math.cos(u)},${r+o*Math.sin(u)} A${o},${o} 0 0,1 ${r+o*Math.cos(h)},${r+o*Math.sin(h)} L${r+t*Math.cos(h)},${r+t*Math.sin(h)} A${t},${t} 0 0,0 ${r+t*Math.cos(u)},${r+t*Math.sin(u)}Z`,
                    g = document.createElementNS("http://www.w3.org/2000/svg", "path");
                g.setAttribute("d", p), g.setAttribute("fill", l % 2 == 0 ? d : c), g.onclick = t => e(a, i, t), n.appendChild(g)
            })
        }
        i(162, 170, "D", "#e53935", "#43a047"), i(107, 162, "S", "#121212", "#eeeeee"), i(99, 107, "T", "#e53935", "#43a047"), i(16, 99, "S", "#121212", "#eeeeee");
        const d = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        d.setAttribute("cx", r), d.setAttribute("cy", r), d.setAttribute("r", 16), d.setAttribute("fill", "#43a047"), d.onclick = t => e(25, "S", t), n.appendChild(d);
        const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        c.setAttribute("cx", r), c.setAttribute("cy", r), c.setAttribute("r", 6), c.setAttribute("fill", "#e53935"), c.onclick = t => e(25, "D", t), n.appendChild(c), t && Stats.data.heatmap.forEach(e => {
            const t = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            t.setAttribute("cx", e.x), t.setAttribute("cy", e.y), t.setAttribute("r", 2), t.setAttribute("fill", "rgba(255, 215, 0, 0.4)"), t.style.pointerEvents = "none", n.appendChild(t)
        }), a.forEach((e, t) => {
            const o = document.createElementNS("http://www.w3.org/2000/svg", "text"), a = (360 * t / 20 - 90) * Math.PI / 180;
            o.setAttribute("x", r + 195 * Math.cos(a)), o.setAttribute("y", r + 195 * Math.sin(a)), o.setAttribute("text-anchor", "middle"), o.setAttribute("dominant-baseline", "middle"), o.setAttribute("fill", "white"), o.textContent = e, o.style.pointerEvents = "none", n.appendChild(o)
        }), o.appendChild(n)
    }
};

// --- APP ---
const app = {
    mode: null,
    state: {},
    inputMode: "board",
    numpadBuffer: "",
    goHome: function() {
        document.getElementById("screen-game").classList.remove("active"), document.getElementById("screen-menu").classList.add("active"), Stats.load()
    },
    toggleInput: function() {
        this.inputMode = "board" === this.inputMode ? "numpad" : "board";
        const e = document.getElementById("board-container"), t = document.getElementById("numpad-container"), o = document.getElementById("touch-controls"), n = document.getElementById("input-toggle");
        "numpad" === this.inputMode ? (e.style.display = "none", t.style.display = "grid", o.style.display = "none", n.innerText = "‚å®Ô∏è", n.classList.add("active")) : (e.style.display = "block", t.style.display = "none", o.style.display = "flex", n.innerText = "üéØ", n.classList.remove("active"))
    },
    numpadAdd: function(e) {
        this.numpadBuffer += e, document.getElementById("status-msg").innerText = "Score: " + this.numpadBuffer
    },
    numpadClear: function() {
        this.numpadBuffer = "", document.getElementById("status-msg").innerText = "Score: "
    },
    numpadSubmit: function() {
        const e = parseInt(this.numpadBuffer);
        return isNaN(e) || e > 180 ? (alert("Invalid Score"), void this.numpadClear()) : (this.state.dartsInTurn = 3, this.handleTurnScore(e), void this.numpadClear())
    },
    loadMode: function(e) {
        this.mode = e, this.state = {
            score: 501, p2Score: 501, currentPlayer: 1, dartsInTurn: 0, turnScore: 0,
            matchScore: [0, 0], matchTotalScore: 0, matchTotalDarts: 0,
            targetList: [], targetIndex: 0, jdcLevel: 0, jdcScore: 0
        }, document.getElementById("screen-menu").classList.remove("active"), document.getElementById("screen-game").classList.add("active"), BoardRenderer.render(this.handleHit.bind(this), "practice" === e), document.getElementById("p2-box").style.visibility = "hidden", document.getElementById("match-score-display").style.visibility = "hidden", "league" === e ? this.setupLeague() : "pvp" === e ? this.setupPvP() : "bobs27" === e ? this.setupBobs27() : "jdc" === e ? this.setupJDC() : document.getElementById("game-title").innerText = "Analysis"
    },
    setupLeague: function() {
        const e = Math.min(4, Stats.data.leagueRank), t = BOTS[e];
        this.state.botIdx = e, document.getElementById("game-title").innerText = `Vs ${t.name}`, document.getElementById("p2-box").style.visibility = "visible", document.getElementById("match-score-display").style.visibility = "visible", this.updateUI()
    },
    setupPvP: function() {
        document.getElementById("game-title").innerText = "P1 vs P2", document.getElementById("hud-lbl-1").innerText = "P1", document.getElementById("hud-lbl-2").innerText = "P2", document.getElementById("p2-box").style.visibility = "visible", document.getElementById("match-score-display").style.visibility = "visible", document.getElementById("hud-val-2").innerText = "501", this.updateUI()
    },
    setupBobs27: function() {
        this.state.targetList = Array.from({length: 20}, ((e, t) => t + 1)), this.state.targetList.push(25), this.state.score = 27, document.getElementById("game-title").innerText = "Bob's 27", document.getElementById("hud-lbl-1").innerText = "SCORE", document.getElementById("hud-val-1").innerText = "27", document.getElementById("p2-box").style.visibility = "visible", document.getElementById("hud-lbl-2").innerText = "TARGET", document.getElementById("hud-val-2").innerText = "D1"
    },
    setupJDC: function() {
        document.getElementById("game-title").innerText = "JDC Challenge", document.getElementById("hud-lbl-1").innerText = "SCORE", document.getElementById("hud-val-1").innerText = "0", document.getElementById("p2-box").style.visibility = "visible", document.getElementById("hud-lbl-2").innerText = "TASK", document.getElementById("hud-val-2").innerText = "10-15 Doubles"
    },
    handleHit: function(e, t, o) {
        if (o) {
            const t = document.getElementById("dartboard-svg"), n = t.createSVGPoint();
            n.x = o.clientX, n.y = o.clientY;
            const a = n.matrixTransform(t.getScreenCTM().inverse());
            Stats.addHeatmapPoint(a.x, a.y);
            const r = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            r.setAttribute("cx", a.x), r.setAttribute("cy", a.y), r.setAttribute("r", 4), r.setAttribute("fill", "#ffd700"), t.appendChild(r)
        }
        let n = e;
        "D" === t && (n *= 2), "T" === t && (n *= 3), document.getElementById("status-msg").innerText = `Hit: ${t}${e}`, this.mode.includes("league") || "pvp" === this.mode ? this.logicX01(n, t) : "bobs27" === this.mode ? this.logicBobs(e, t) : "jdc" === this.mode && this.logicJDC(e, t)
    },
    handleTurnScore: function(e) {
        "league" === this.mode || "pvp" === this.mode ? this.logicX01(e, "S", !0) : null
    },
    logicX01: function(e, t, o = !1) {
        const n = 1 === this.state.currentPlayer ? this.state.score : this.state.p2Score;
        if (!o && (this.state.dartsInTurn >= 3)) return;
        o || this.state.dartsInTurn++;
        const a = n - e, r = 0 === a && ("D" === t || o);
        if (r) {
            this.state.matchScore[1 === this.state.currentPlayer ? 0 : 1]++, Speaker.speak("Game Shot", 100);
            if (o) {
                let e = prompt("Darts used? (1, 2, or 3)", "1");
                this.state.dartsInTurn = parseInt(e) || 3
            }
            1 === this.state.currentPlayer && (this.state.matchTotalScore += 501, this.state.matchTotalDarts += this.state.dartsInTurn), this.checkMatchWin()
        } else a <= 1 && 0 !== a ? (Speaker.speak("Bust!", 0), this.state.turnScore = 0, o || (this.state.dartsInTurn = 3)) : (1 === this.state.currentPlayer ? this.state.score = a : this.state.p2Score = a, this.state.turnScore += e, Speaker.speak(`${e}`, e));
        this.updateUI()
    },
    checkMatchWin: function() {
        if (this.state.matchScore[0] >= 3 || this.state.matchScore[1] >= 3) {
            if ("league" === this.mode && this.state.matchScore[0] >= 3) {
                const e = this.state.matchTotalDarts > 0 ? (this.state.matchTotalScore / this.state.matchTotalDarts * 3).toFixed(1) : "0.0";
                Stats.addMatch(e, "W"), Stats.updateLeague(this.state.botIdx)
            }
            alert(`Match Over! ${this.state.matchScore[0]} - ${this.state.matchScore[1]}`), this.goHome()
        } else alert(`Leg Over. ${this.state.matchScore[0]} - ${this.state.matchScore[1]}`), this.resetLeg()
    },
    resetLeg: function() {
        this.state.score = 501, this.state.p2Score = 501, this.state.dartsInTurn = 0, this.state.turnScore = 0, BoardRenderer.render(this.handleHit.bind(this), !1), this.updateUI()
    },
    updateUI: function() {
        document.getElementById("hud-val-1").innerText = this.state.score, document.getElementById("hud-val-2").innerText = "league" === this.mode ? this.state.p2Score : this.state.p2Score, document.getElementById("match-score-display").innerText = `${this.state.matchScore[0]} - ${this.state.matchScore[1]}`;
        const e = document.getElementById("p1-box"), t = document.getElementById("p2-box");
        1 === this.state.currentPlayer ? (e.classList.remove("inactive"), t.classList.add("inactive")) : (t.classList.remove("inactive"), e.classList.add("inactive"));
        const o = Strategist.getCheckout(1 === this.state.currentPlayer ? this.state.score : this.state.p2Score);
        document.getElementById("checkout-display").innerText = o ? o : ""
    },
    logicBobs: function(e, t) {
        if (this.state.dartsInTurn >= 3) return;
        this.state.dartsInTurn++;
        const o = this.state.targetList[this.state.targetIndex], n = 25 === o;
        let a = 0;
        n && 25 === e && "D" === t ? a = 50 : !n && e === o && "D" === t && (a = 2 * e), a > 0 ? (this.state.turnScore += a, this.state.score += a, Speaker.speak("Yes!", 60)) : Speaker.speak("Miss", 0), document.getElementById("hud-val-1").innerText = this.state.score
    },
    logicJDC: function(e, t) {
        const o = this.state.jdcLevel;
        let n = 0;
        o < 6 ? e >= 10 && e <= 15 && "D" === t && (n = e * 2) : o < 12 ? e >= 15 && e <= 20 && "T" === t && (n = e * 3) : 25 === e && (n = 50), n > 0 && (this.state.turnScore += n, this.state.score += n, Speaker.speak("Yes!", 60)), this.state.dartsInTurn++, this.state.dartsInTurn >= 3 && (this.state.jdcLevel++, this.state.dartsInTurn = 0, document.getElementById("hud-val-1").innerText = this.state.score, this.state.jdcLevel >= 15 && (alert("JDC Finished! Score: " + this.state.score), this.goHome()))
    },
    handleAction: function() {
        if ("league" === this.mode) {
            if (0 === this.state.dartsInTurn && "board" === this.inputMode) return;
            document.getElementById("status-msg").innerText = "Opponent throwing...";
            const e = BOTS[this.state.botIdx];
            setTimeout((() => {
                const t = Math.floor(20 * Math.random()) - 10;
                let o = e.avg + t;
                this.state.p2Score - o <= 1 && (Math.random() < e.checkout ? (this.state.matchScore[1]++, Speaker.speak("Game Shot", 100), this.checkMatchWin()) : o = 0), this.state.p2Score -= o, this.updateUI(), document.getElementById("status-msg").innerText = "Your Turn", this.state.dartsInTurn = 0, this.state.turnScore = 0, "board" === this.inputMode && BoardRenderer.render(this.handleHit.bind(this))
            }), 800)
        } else if ("pvp" === this.mode) {
            if (0 === this.state.dartsInTurn && "board" === this.inputMode) return;
            this.state.currentPlayer = 1 === this.state.currentPlayer ? 2 : 1, this.state.dartsInTurn = 0, this.state.turnScore = 0, Speaker.speak("Player " + this.state.currentPlayer, 0), this.updateUI(), "board" === this.inputMode && BoardRenderer.render(this.handleHit.bind(this))
        } else if ("bobs27" === this.mode) {
            0 === this.state.turnScore && (this.state.score -= 25 === this.state.targetList[this.state.targetIndex] ? 25 : 2 * this.state.targetList[this.state.targetIndex], Speaker.speak("Minus", 0)), this.state.score < 0 ? (alert("BUST!"), this.goHome()) : (this.state.targetIndex++, this.state.targetIndex >= this.state.targetList.length ? (alert("Finished!"), this.goHome()) : (document.getElementById("hud-val-1").innerText = this.state.score, document.getElementById("hud-val-2").innerText = 25 === this.state.targetList[this.state.targetIndex] ? "Bull" : "D" + this.state.targetList[this.state.targetIndex], this.state.dartsInTurn = 0, this.state.turnScore = 0, BoardRenderer.render(this.handleHit.bind(this))))
        }
    },
    undo: function() {
        alert("Undo disabled in Pro Mode")
    }
};
</script>
</body>
</html>
